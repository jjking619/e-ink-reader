

# 7.5英寸电子墨水屏文本阅读器（适用于 Linux 开发板）

## 一、项目简介

这是一个专为 **Linux 嵌入式平台**（Quectel-Pi-H1）设计的 **文本阅读器**，支持连接 **Waveshare / Good Display 的 7.5 英寸黑白 EPD 屏幕（型号：EPD_7in5_V2）**，并通过 GPIO 按键实现翻页控制与书籍切换。

## 二、功能特性 

| 功能项             | 描述                                                                 |
|--------------------|----------------------------------------------------------------------|
| 多语言支持         | 纯英文、纯中文（GB2312）、中英混合文本正确渲染                          |
| 自动排版           | 不裁剪字符，自动换行，支持跨页内容延续                                 |
| 页面记忆           | 支持返回前一页并保证像素级一致                                         |
| 多书管理           | 长按按钮可在不同书籍之间切换                                           |
| 跨平台部署         | 支持交叉编译至 ARM 架构嵌入式 Linux 平台                              |

## 三、软硬件要求
### 🔧 硬件配置
- **主控板**：Quectel-Pi-H1
- **显示屏**：Waveshare 7.5" 黑白电子墨水屏（EPD_7in5_V2）
- **输入设备**：至少两个物理按键（已经映射为 `/dev/input/eventX` 设备）

### 软件依赖
- **操作系统**：Linux（建议 Ubuntu 22.04+ 或嵌入式发行版）
- **编译工具链**：GCC for ARM（如 `aarch64-qcom-linux-gcc`）

## 四、目录结构说明

```
/tools/
└── books/            # 存放待阅读的 TXT 文本（必须为 GB2312 编码）
/c/                   # C语言源码目录
├── lib/
│   ├── Config/       # 硬件接口层（GPIO/SPI 初始化等）
│   ├── GUI/          # 图形绘制库（画点、线、文字等）
│   ├── Fonts/        # 字体资源（ASCII 和中文 GB2312 字模）
│   └── e-paper/      # 各型号 EPD 驱动代码
├── Examples/         # 示例测试程序
└── main.c            # 主程序入口
```

## 五、快速部署指南 

### 步骤 1：准备书籍文件

```bash
mkdir -p /tools/books
# 将您的 .txt 文件放入此目录，并确保编码为 GB2312
# Windows 用户操作路径：记事本 → 另存为 → 编码选“ANSI”（即 GB2312）
# 或者使用 Notepad++ 等软件进行编码转换
```

### 步骤 2：上传源码并编译

将整个 `c/` 目录拷贝到目标开发板中，进入该目录后执行：

```bash
make CC=aarch64-qcom-linux-gcc EPD=epd7in5V2
```

> 注：根据实际使用的交叉编译器名称调整 `CC=` 参数

编译成功后会生成可执行文件 epd。

### 步骤 3：硬件接线与权限设置

- 按照官方文档连接 EPD 屏幕至 SPI 接口（参考下方默认引脚表）
- 确保按键已被注册为标准 input 设备（可通过 `/dev/input/eventX` 查看）

#### 默认 EPD 引脚定义
管脚连接可以在\lib\Config目录下查看DEV_Config.h中查看
| EPD 引脚 | BCM编号 |
|----------|---------|
| VCC      | 3.3V    |
| GND      | GND     |
| DIN      | 10 (MOSI)|
| CLK      | 11 (SCK) |
| CS       | 8 (CE0)  |
| DC       | 25      |
| RST      | 17      |
| BUSY     | 24      |


### 步骤 4：运行阅读器

```bash
sudo ./epd
```

> 若修改过源码，请先运行 `make clean` 清理旧对象再重新编译。

## 六、使用方法 

- **短按按键 A/B**：向上/向下翻页
- **长按任意按键约 2 秒以上**：弹出书籍选择菜单，切换当前阅读书籍
- 所有状态信息将在终端打印（可用 串口 查看）

## 七、注意事项 

- 所有 TXT 文件必须使用 **GB2312 编码**，否则中文会出现乱码。
- 若需支持 UTF-8，请考虑集成 Freetype 库或将文本预处理为 GB2312。
- 翻页逻辑基于页面缓存机制，确保前后一致性。

## 八、常见问题排查（FAQ）

| 问题                             | 解决方案                                               |
|----------------------------------|--------------------------------------------------------|
| 屏幕无响应或显示异常              | 检查 SPI 连接是否牢固，GPIO 是否配置正确               |
| 中文显示乱码                      | 确认 TXT 文件编码为 GB2312                            |
| 按键无效                          | 使用 `cat /proc/bus/input/devices` 查找 event 设备并确认权限 |
| 编译失败                          | 检查交叉编译工具链是否存在且路径正确                   |

## 九、未来开发计划 

| 计划项                 | 状态     |
|------------------------|----------|
| 更流畅的刷新动画优化   | 待完成   |
| 支持 UTF-8 编码        | 已支持（需额外转换或集成字体引擎） |
| Wi-Fi 无线传书         | 已支持（内置 HTTP Server）         |
| 添加书签保存功能       | 已支持（记录位置偏移）             |



如有疑问或技术支持需求。